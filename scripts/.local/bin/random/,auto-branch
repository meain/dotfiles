#!/bin/sh

set -e

PROMPT="Give me a branch name based on the provided git commit message.
Keep it to 3 words or less and separated by '-'.
Only return the branch name without anything else in your response."

input="$*"
if [ -z "$1" ]; then
    input="@"
fi

echo "$input" | tr ' ' '\n' | while read -r commit; do
    branch="$(jj log --template=description -r "$commit" --no-graph | esa +notools "$PROMPT")"
    jj bookmark set "meain/$branch" -r "$commit" # use jj undo to undo bookmarking
done
