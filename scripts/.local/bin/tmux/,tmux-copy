#!/bin/sh

set -e

text=$(tmux capture-pane -J -p)

{
    # UUIDs (8-4-4-4-12 format)
    echo "$text" | grep -oE '\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\b' | sed 's/^/UUID: /'

    # Git SHA (7-40 hex chars, avoiding UUIDs)
    echo "$text" | grep -oE '\b[0-9a-f]{7,40}\b' | grep -v -- '-' | sed 's/^/SHA: /'

    # Jujutsu bookmarks (will be within [])
    echo "$text" | grep -oE '\[meain/[^]]+\]' | sed 's/^\[//;s/\]$//;s/^/JJ: /'

    # File paths (specific extensions)
    # echo "$text" | grep -oE '[^[:space:]<>"|*?]*\.(go|py|rs|js|ts|json|yaml|yml|md)[[:space:]]' |
    #     grep -v '^https\?:' | sed 's/^/FILE: /'

    # IP addresses
    echo "$text" | grep -oE '\b[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\b' | sed 's/^/IP: /'

    # URLs
    echo "$text" | grep -oE '(https?|ftp|file):/?//[-A-Za-z0-9+&@#/%?=~_|!:,.;]*[-A-Za-z0-9+&@#/%=~_|]' | sed 's/^/URL: /'

    # Email addresses
    echo "$text" | grep -oE '\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b' | sed 's/^/EMAIL: /'
} | sort -u | fzf -m --prompt "Select item: " | cut -d' ' -f2- | tr -d '\n' | pbcopy
